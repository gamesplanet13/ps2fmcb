<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Games Planet – Quick Order (Prefilled)</title>
<style>
  :root{--bg:#0b1020;--card:#121a33;--muted:#9fb0d3;--text:#eaf1ff;--ok:#3ddc84}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:900px;margin:0 auto;padding:22px 16px 60px}
  h1{margin:0 0 6px}
  .sub{color:var(--muted);margin-bottom:18px}
  .card{background:var(--card);border-radius:16px;padding:16px;margin:12px 0}
  .row{display:grid;grid-template-columns:2fr .8fr .8fr .4fr;gap:8px;align-items:center;margin-bottom:8px}
  input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0e1530;color:#fff}
  .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  button,a.btn{border:0;padding:11px 14px;border-radius:12px;font-weight:800;cursor:pointer;text-decoration:none}
  .act{background:var(--ok);color:#04190b}
  .alt{background:#ffd54f;color:#2b2100}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,.2);color:#fff}
  .badge{display:inline-block;background:#1b2447;border-radius:999px;padding:6px 10px;font-weight:700;margin-right:6px;color:var(--muted)}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
  .hint{color:var(--muted);font-size:13px;margin-top:6px}
  @media(max-width:900px){.grid3{grid-template-columns:1fr 1fr}}
  @media(max-width:720px){.grid2,.grid3{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <h1>Games Planet — Quick Order</h1>
  <div class="sub">Prefilled from main page • India Post pincode autofill • Payment rules applied here</div>

  <!-- Payment Mode -->
  <div class="card">
    <span class="badge">Payment Mode</span>
    <div class="btns">
      <button id="btn-prepaid" class="ghost" onclick="setMode('prepaid')">🟢 Prepaid</button>
      <button id="btn-cod" class="ghost" onclick="setMode('cod')">🔴 COD</button>
    </div>
    <div class="hint">Note: <b>Prepaid delivery free</b>. FMCB cards are <b>Prepaid only</b>.</div>
  </div>

  <!-- Coupon (only for Prepaid) -->
  <div class="card" id="couponCard" style="display:none">
    <span class="badge">Coupon</span>
    <div class="grid2">
      <input id="couponCode" placeholder="Enter Coupon Code">
      <button class="ghost" onclick="applyCoupon()">Apply</button>
    </div>
    <div class="hint" id="couponNote"></div>
  </div>

  <!-- Customer -->
  <div class="card">
    <span class="badge">Customer</span>
    <div class="grid2">
      <input id="name" placeholder="Name">
      <input id="mobile" placeholder="Mobile">
    </div>
    <div class="grid2">
      <input id="altMobile" placeholder="Alt Mobile">
      <input id="email" placeholder="Email">
    </div>
    <textarea id="address" placeholder="Address (Area/Village/Street)" rows="2"></textarea>
    <div class="grid3" style="margin-top:8px">
      <input id="house" placeholder="House number">
      <input id="landmark" placeholder="Landmark">
      <input id="pincode" placeholder="Pincode">
    </div>
    <div id="deliveryEstimate" class="hint" style="white-space:pre-line;margin-top:8px"></div>
    <div class="grid3" style="margin-top:8px">
      <input id="state" placeholder="State" readonly>
      <input id="city" placeholder="District/City" readonly>
      <select id="postoffice"><option value="">Select Post Office</option></select>
    </div>
  </div>

  <!-- Order Details -->
  <div class="card">
    <span class="badge">Order Details</span>
    <div class="grid2">
      <input id="product" placeholder="Product">
      <input id="variant" placeholder="Variant">
    </div>
    <input id="basePrice" type="number" placeholder="Base Price (₹)">
    <!-- Prepaid only -->
    <input id="discountAmount" type="number" placeholder="Discount Applied" readonly style="display:none">
    <!-- COD only -->
    <input id="codCharges" type="number" placeholder="COD Charges" readonly style="display:none">
    <input id="restAmount" type="number" placeholder="Rest on Delivery" readonly style="display:none">
    <!-- Both -->
    <input id="amountPaid" type="number" placeholder="Amount Paid">
    <div class="hint" id="ruleNote"></div>
  </div>

  <!-- Delivery Meta -->
  <div class="card">
    <span class="badge">Delivery Meta</span>
    <div class="grid3">
      <input id="distance" placeholder="Distance (auto)">
      <input id="etaText" placeholder="ETA (auto)">
      <input id="dateRange" placeholder="Estimated Delivery (auto)">
    </div>
    <input id="orderId" placeholder="Order ID (auto)" readonly style="margin-top:8px">
  </div>

  <!-- Actions -->
  <div class="btns">
    <a id="payNow" class="btn act" href="#" target="_blank" rel="noopener">Pay Now</a>
    <button class="alt" onclick="sendWhatsApp()">Send on WhatsApp</button>
  </div>
</div>

<script>
const WHATSAPP_PHONE="917983624797";
const UPI_ID="paytmqr5hyx5o@ptys";
const UPI_NAME="Surender Kaur";
let discountValue=0,mode="prepaid";

/* Coupon */
function applyCoupon(){
  const code=(document.getElementById("couponCode").value||"").trim().toLowerCase();
  if(code==="gpz2025"){
    if(mode==="prepaid"){
      const base=+document.getElementById("basePrice").value||0;
      discountValue=Math.round(base*0.05);
      document.getElementById("couponNote").innerText=`✅ Coupon applied: -₹${discountValue}`;
    }else{
      discountValue=0;
      document.getElementById("couponNote").innerText="❌ Coupon only valid on Prepaid";
    }
  }else{discountValue=0;document.getElementById("couponNote").innerText="❌ Invalid coupon";}
  computeTotals();
}

/* Mode toggle */
function setMode(m){
  mode=m;
  document.getElementById("btn-prepaid").className=(m==="prepaid"?"ghost act":"ghost");
  document.getElementById("btn-cod").className=(m==="cod"?"ghost act":"ghost");
  document.getElementById("couponCard").style.display=(m==="prepaid"?"block":"none");
  computeTotals();
}

/* Totals */
function computeCodCharge(base){
  if(mode!=="cod")return 0;
  const isOptional=/optional/i.test((document.getElementById("variant").value||""));
  if(isOptional)return 99;
  return base>2000?0:99;
}
function computeTotals(){
  const base=+document.getElementById("basePrice").value||0;
  let codC=0,paid=0,rest=0;
  document.getElementById("discountAmount").style.display=(mode==="prepaid")?"block":"none";
  document.getElementById("codCharges").style.display=(mode==="cod")?"block":"none";
  document.getElementById("restAmount").style.display=(mode==="cod")?"block":"none";
  if(mode==="prepaid"){
    let eff=base;
    if(discountValue>0){eff=base-discountValue;document.getElementById("discountAmount").value=discountValue;}
    else document.getElementById("discountAmount").value="";
    paid=eff;
  }else{
    discountValue=0;document.getElementById("discountAmount").value="";
    codC=computeCodCharge(base);document.getElementById("codCharges").value=codC;
    paid=Math.max(500,Math.ceil((base+codC)*0.10));
    rest=base+codC-paid;document.getElementById("restAmount").value=rest;
  }
  document.getElementById("amountPaid").value=paid;
  document.getElementById("payNow").href=upiLink(paid,(mode==="prepaid"?"Prepaid":"Advance")+" for Games Planet Order");
}

/* Utils */
function rs(n){return "₹"+(Number(n)||0).toLocaleString("en-IN");}
function upiLink(amount,note){const p=new URLSearchParams({pa:UPI_ID,pn:UPI_NAME,am:String(amount||0),cu:"INR",tn:note});return "upi://pay?"+p;}
function orderIdNow(){const d=new Date();return d.getDate().toString().padStart(2,"0")+ (d.getMonth()+1).toString().padStart(2,"0")+d.getFullYear()+d.getHours()+d.getMinutes()+d.getSeconds()+"00";}

/* WhatsApp */
function sendWhatsApp(){
  const id=document.getElementById("orderId").value||orderIdNow();
  const lines=[
    mode==="prepaid"?"🟢 Prepaid Order on WhatsApp":"🔴 COD Order on WhatsApp","",
    `Order ID: ${id}`,
    `Name: ${document.getElementById("name").value}`,
    `Mobile: ${document.getElementById("mobile").value}`,
    `Alt Mobile: ${document.getElementById("altMobile").value}`,
    `Email: ${document.getElementById("email").value}`,
    `Address: ${document.getElementById("address").value}`,
    `House number: ${document.getElementById("house").value}`,
    `Landmark: ${document.getElementById("landmark").value}`,
    `Pincode: ${document.getElementById("pincode").value}`,
    `State: ${document.getElementById("state").value}`,
    `District/City: ${document.getElementById("city").value}`,
    `Post office: ${document.getElementById("postoffice").value}`,"",
    `Product: ${document.getElementById("product").value}`,
    `Variant: ${document.getElementById("variant").value}`,
    `Base Price: ${rs(+document.getElementById("basePrice").value)}`,
    (mode==="prepaid"&&discountValue>0)?`Discount Applied: -${rs(discountValue)}`:null,
    mode==="prepaid"?`Amount Paid: ${rs(+document.getElementById("amountPaid").value)}`:
    `Advance Paid: ${rs(+document.getElementById("amountPaid").value)}\nCOD Charges: ${rs(+document.getElementById("codCharges").value)}\nRest on Delivery: ${rs(+document.getElementById("restAmount").value)}`,
    "",
    `📏 Distance: ${document.getElementById("distance").value}`,
    `⏳ ETA: ${document.getElementById("etaText").value}`,
    `📅 Estimated Delivery: ${document.getElementById("dateRange").value}`,"",
    `💳 Pay Link: ${document.getElementById("payNow").href}`
  ].filter(Boolean).join("\n");
  window.open(`https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(lines)}`,'_blank');
}

/* Pincode auto fill (India Post) + ETA */
let pincodeLatLng={};
fetch('pincode_data.json').then(r=>r.json()).then(j=>pincodeLatLng=j);
function haversine(lat1,lon1,lat2,lon2){const R=6371;const dLat=(lat2-lat1)*Math.PI/180,dLon=(lon2-lon1)*Math.PI/180;const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));}
function etaByDist(d){if(d<=30)return"1 day";if(d<=60)return"1-2 days";if(d<=100)return"2-3 days";if(d<=200)return"3-4 days";if(d<=500)return"4-5 days";if(d<=1000)return"4-6 days";if(d<=1500)return"5–7 days";if(d<=2000)return"6–8 days";if(d<=3000)return"6–10 days";return"8–12 days";}
function dateRange(eta){const n=(eta.match(/\d+/g)||[]).map(Number);if(!n.length)return"";const min=Math.min(...n),max=Math.max(...n);const s=new Date(),e=new Date();s.setDate(s.getDate()+min);e.setDate(e.getDate()+max);return `${s.getDate()}-${e.getDate()} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s.getMonth()]}`;}

document.getElementById("pincode").addEventListener("input",function(){
  const pin=this.value.trim();
  if(pin.length===6){
    fetch(`https://api.postalpincode.in/pincode/${pin}`).then(r=>r.json()).then(data=>{
      if(data[0].Status==="Success"){
        const po=data[0].PostOffice[0];
        document.getElementById("state").value=po.State;
        document.getElementById("city").value=po.District;
        const sel=document.getElementById("postoffice");sel.innerHTML='<option value="">Select Post Office</option>';
        data[0].PostOffice.forEach(p=>{const o=document.createElement("option");o.value=p.Name;o.text=p.Name;sel.appendChild(o);});
        if(pincodeLatLng[pin]){const baseLat=28.8,baseLng=79.0;const {lat,lng}=pincodeLatLng[pin];const d=haversine(baseLat,baseLng,lat,lng).toFixed(0);const eta=etaByDist(d);const rng=dateRange(eta);
          document.getElementById("distance").value=`${d} km`;
          document.getElementById("etaText").value=eta;
          document.getElementById("dateRange").value=rng;
          document.getElementById("deliveryEstimate").innerText=`📍 Distance: ${d} km\n⏳ ETA: ${eta}\n📅 Delivery: ${rng}`;
        }
      }
    });
  }
});

/* Prefill defaults */
(function(){
  document.getElementById("orderId").value=orderIdNow();
  setMode("prepaid");
  computeTotals();
})();
</script>
</body>
</html>
